var bon;(function(t){t.inRange=function(t,i,e){return i<=t&&t<=e};var i=function(){function t(t){this.position=0,this.reset(t)}return Object.defineProperty(t.prototype,"dataView",{get:function(){return this._dataView||(this._dataView=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength))},enumerable:!0,configurable:!0}),t.prototype.reset=function(t){this.data=t,this.position=0,this._dataView=null},t.prototype.validate=function(t){return!(this.position+t>this.data.length&&(console.error("read eof"),1))},t.prototype.readUInt8=function(){if(this.validate(1))return this.data[this.position++]},t.prototype.readInt32=function(){if(this.validate(4))return this.data[this.position++]|this.data[this.position++]<<8|this.data[this.position++]<<16|this.data[this.position++]<<24},t.prototype.readInt64=function(){var t=this.readInt32();return t<0&&(t+=4294967296),t+4294967296*this.readInt32()},t.prototype.readFloat32=function(){if(this.validate(4)){var t=this.dataView.getFloat32(this.position,!0);return this.position+=4,t}},t.prototype.readFloat64=function(){if(this.validate(8)){var t=this.dataView.getFloat64(this.position,!0);return this.position+=8,t}},t.prototype.read7BitInt=function(){var t=0,i=0,e=0;do{if(35==e)throw Error("Format_Bad7BitInt32");i|=(127&(t=this.readUInt8()))<<e,e+=7}while(0!=(128&t));return i},t.prototype.readUTF=function(){var t=this.read7BitInt();return this.readUTFBytes(t)},t.prototype.readUint8Array=function(t,i){return void 0===i&&(i=!1),i?this.data.slice(this.position,this.position+t):this.data.subarray(this.position,this.position+t)},t.prototype.readUTFBytes=function(t){if(this.validate(t)){var i=this.data.subarray(this.position,this.position+t);return this.position+=t,this.decodeUTF8(i)}},t.prototype.decoderError=function(t){throw new Error("decode error at "+this.position+": "+t)},t.prototype.decodeUTF8=function(t){for(var i=0,e="";i<t.byteLength;){var r=t[i++];0!=(128&r)?192!=(224&r)?224!=(240&r)?240!=(248&r)?248!=(252&r)?252!=(254&r)?this.decoderError("unsuport utf8 code: "+r):e+=String.fromCodePoint((1&r)<<30|(63&t[i++])<<24|(63&t[i++])<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++]):e+=String.fromCodePoint((3&r)<<24|(63&t[i++])<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++]):e+=String.fromCodePoint((7&r)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++]):e+=String.fromCharCode((15&r)<<12|(63&t[i++])<<6|63&t[i++]):e+=String.fromCharCode((31&r)<<6|63&t[i++]):e+=String.fromCharCode(r)}return e},t}();t.DataReader=i})(bon||(bon={})),function(t){var i=new Uint8Array(524288),e=function(){function t(){this.position=0,this.data=i}return Object.defineProperty(t.prototype,"dataView",{get:function(){return this._dataView||(this._dataView=new DataView(this.data.buffer,0,this.data.byteLength))},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.data=i,this._dataView=null,this.position=0},t.prototype.ensureBuffer=function(t){this.position+t>i.byteLength&&(this.data=i=new Uint8Array(Math.max((i.byteLength,~~(this.position+t)))),this._dataView=null)},t.prototype.writeInt8=function(t){this.ensureBuffer(1),this.data[this.position++]=~~t},t.prototype.writeInt32=function(t){this.ensureBuffer(4),this.data[this.position++]=~~t,this.data[this.position++]=t>>8,this.data[this.position++]=t>>16,this.data[this.position++]=t>>24},t.prototype.writeInt64=function(t){this.writeInt32(t),t<0?this.writeInt32(~(-t/4294967296)):this.writeInt32(~~(t/4294967296))},t.prototype.writeFloat32=function(t){this.ensureBuffer(4),this.dataView.setFloat32(this.position,t,!0),this.position+=4},t.prototype.writeFloat64=function(t){this.ensureBuffer(8),this.dataView.setFloat64(this.position,t,!0),this.position+=8},t.prototype.write7BitInt=function(t){for(var i=~~t;i>=128;)this.writeInt8(128|i),i>>>=7;this.writeInt8(i)},t.prototype.writeUTF=function(t){var i=this.position;this.ensureBuffer(8),this.position+=8;var e=this.position;this.writeUTFBytes(t);var r=this.position;this.position=i;var n=r-e;this.write7BitInt(n),this.data.copyWithin(this.position,e,r),this.position+=n},t.prototype.writeUint8Array=function(t,i,e){(i=~~i)<0||(e=e?Math.min(~~e,t.length-i):t.length-i)<=0||(this.ensureBuffer(e),this.data.set(t.subarray(i,i+e),this.position),this.position+=e)},t.prototype.encoderError=function(t){throw new Error("encode error at "+this.position+": "+t)},t.prototype.writeUTFBytes=function(t){for(var i=0;i<t.length;i++){var e=t.codePointAt(i);e<0&&this.encoderError("unsupport code point: "+e),e<=127?this.writeInt8(e):e<=2047?(this.writeInt8(e>>>6|192),this.writeInt8(e>>>0&63|128)):e<=65535?(this.writeInt8(e>>>12|224),this.writeInt8(e>>>6&63|128),this.writeInt8(e>>>0&63|128)):e<=2097151?(this.writeInt8(e>>>18|240),this.writeInt8(e>>>12&63|128),this.writeInt8(e>>>6&63|128),this.writeInt8(e>>>0&63|128),i++):e<=67108863?(this.writeInt8(e>>>24|248),this.writeInt8(e>>>18&63|128),this.writeInt8(e>>>12&63|128),this.writeInt8(e>>>6&63|128),this.writeInt8(e>>>0&63|128),i++):e<=2147483647?(this.writeInt8(e>>>30|252),this.writeInt8(e>>>24&63|128),this.writeInt8(e>>>18&63|128),this.writeInt8(e>>>12&63|128),this.writeInt8(e>>>6&63|128),this.writeInt8(e>>>0&63|128),i++):this.encoderError("unsupport code point: "+e)}},t.prototype.getBytes=function(t){return void 0===t&&(t=!1),t?this.data.slice(0,this.position):this.data.subarray(0,this.position)},t}();t.DataWriter=e}(bon||(bon={})),function(t){var i=function(){function i(){this.dw=new t.DataWriter,this.strMap=new Map}return i.prototype.reset=function(){this.dw.reset(),this.strMap.clear()},i.prototype.encodeInt=function(t){this.dw.writeInt8(1),this.dw.writeInt32(t)},i.prototype.encodeLong=function(t){this.dw.writeInt8(2),this.dw.writeInt64(t)},i.prototype.encodeFloat=function(t){this.dw.writeInt8(3),this.dw.writeFloat32(t)},i.prototype.encodeDouble=function(t){this.dw.writeInt8(4),this.dw.writeFloat64(t)},i.prototype.encodeNumber=function(t){~~t===t?(this.dw.writeInt8(1),this.dw.writeInt32(t)):(this.dw.writeInt8(4),this.dw.writeFloat64(t))},i.prototype.encodeString=function(t){var i=this.strMap.get(t);void 0!==i?(this.dw.writeInt8(99),this.dw.write7BitInt(i)):(this.dw.writeInt8(5),this.dw.writeUTF(t),this.strMap.set(t,this.strMap.size))},i.prototype.encodeBoolean=function(t){this.dw.writeInt8(6),this.dw.writeInt8(t?1:0)},i.prototype.encodeNull=function(){this.dw.writeInt8(0)},i.prototype.encodeDateTime=function(t){this.dw.writeInt8(10),this.dw.writeInt64(t.getTime())},i.prototype.encodeBinary=function(t){this.dw.writeInt8(7),this.dw.write7BitInt(t.byteLength),this.dw.writeUint8Array(t)},i.prototype.encodeArray=function(t){this.dw.writeInt8(9),this.dw.write7BitInt(t.length);for(var i=t.length,e=0;e<i;++e)this.encode(t[e])},i.prototype.encodeMap=function(t){var i=this;this.dw.writeInt8(8),this.dw.write7BitInt(t.size),t.forEach(function(t,e){i.encode(e),i.encode(t)})},i.prototype.encodeObject=function(t){this.dw.writeInt8(8);var i=Object.keys(t),e=i.length;this.dw.write7BitInt(e);for(var r=0,n=i;r<n.length;r++){var o=n[r];this.encode(o),this.encode(t[o])}},i.prototype.encode=function(t){switch(typeof t){default:this.encodeNull();break;case"number":this.encodeNumber(t);break;case"boolean":this.encodeBoolean(t);break;case"string":this.encodeString(t);break;case"object":if(!t){this.encodeNull();break}if("function"==typeof t.encodeBon){t.encodeBon(this);break}if(t instanceof Array){this.encodeArray(t);break}if(t instanceof Map){this.encodeMap(t);break}if(t instanceof Date){this.encodeDateTime(t);break}if(t instanceof Uint8Array){this.encodeBinary(t);break}this.encodeObject(t)}},i.prototype.getBytes=function(t){return void 0===t&&(t=!1),this.dw.getBytes(t)},i}();t.BonEncoder=i;var e=function(){function i(){this.dr=new t.DataReader(null),this.strArr=[]}return i.prototype.reset=function(t){this.dr.reset(t),this.strArr.length=0},i.prototype.decode=function(){switch(this.dr.readUInt8()){default:return null;case 1:return this.dr.readInt32();case 2:return this.dr.readInt64();case 3:return this.dr.readFloat32();case 4:return this.dr.readFloat64();case 5:var t=this.dr.readUTF();return this.strArr.push(t),t;case 6:return 1==this.dr.readUInt8();case 7:return this.dr.readUint8Array(this.dr.read7BitInt(),!1);case 8:for(var i=this.dr.read7BitInt(),e={},r=0;r<i;r++){var n=this.decode(),o=this.decode();e[n]=o}return e;case 9:i=this.dr.read7BitInt();var s=new Array(i);for(r=0;r<i;r++)s[r]=this.decode();return s;case 10:return new Date(this.dr.readInt64());case 99:return this.strArr[this.dr.read7BitInt()]}},i}();t.BonDecoder=e}(bon||(bon={})),function(t){var i=new t.BonEncoder;t.encode=function(t){var e=i;return e.reset(),e.encode(t),e.getBytes(!0)};var e=new t.BonDecoder;t.decode=function(t){var i=e;return i.reset(t),i.decode()}}(bon||(bon={})),"object"==typeof exports&&"undefined"!=typeof module&&(module.exports=bon);try{window.bon=bon}catch(e){}